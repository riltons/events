// Script para criar eventos da semana
// Portal de Eventos Garanhuns

import { Client } from 'pg';

const config = {
  host: 'localhost',
  port: 5432,
  database: 'eventos_garanhuns_dev',
  user: 'postgres',
  password: 'postgres123',
};

async function criarEventosSemana() {
  const client = new Client(config);
  
  try {
    console.log('üîÑ Conectando ao banco PostgreSQL...');
    await client.connect();
    console.log('‚úÖ Conectado com sucesso!');

    // Primeiro, vamos buscar os IDs necess√°rios
    console.log('üîç Buscando categorias e usu√°rios...');
    
    const categoriasResult = await client.query(`
      SELECT id, slug FROM event_categories 
      WHERE slug IN ('forro', 'religioso', 'cultural', 'gastronomico', 'gospel')
    `);
    
    const categorias = {};
    categoriasResult.rows.forEach(row => {
      categorias[row.slug] = row.id;
    });
    
    console.log('üìã Categorias encontradas:', Object.keys(categorias));
    
    // Buscar usu√°rio criador
    const usuarioResult = await client.query('SELECT id FROM user_profiles LIMIT 1');
    let usuarioId;
    
    if (usuarioResult.rows.length > 0) {
      usuarioId = usuarioResult.rows[0].id;
      console.log('üë§ Usu√°rio encontrado:', usuarioId);
    } else {
      console.log('üë§ Criando usu√°rio administrador...');
      const newUserResult = await client.query(`
        INSERT INTO auth.users (id, email, created_at) 
        VALUES (gen_random_uuid(), 'admin@eventosgaranhuns.com.br', NOW())
        RETURNING id
      `);
      usuarioId = newUserResult.rows[0].id;
      
      await client.query(`
        INSERT INTO user_profiles (id, full_name, user_type, status)
        VALUES ($1, 'Administrador Portal', 'event_admin', 'active')
      `, [usuarioId]);
    }

    console.log('üéâ Criando eventos da semana...');

    // Evento 1: Show de Forr√≥ - Quarta-feira
    await client.query(`
      INSERT INTO events (
        title, slug, description, short_description, event_type, category_id, created_by,
        status, is_featured, is_official, start_date, end_date, venue_name, address,
        is_free, contact_info, organizer_info, banner_image, tags
      ) VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19)
    `, [
      'Forr√≥ do Meio da Semana - Wesley Safad√£o',
      'forro-meio-semana-wesley-safadao',
      'Uma noite especial com o rei do forr√≥ Wesley Safad√£o no cora√ß√£o de Garanhuns. Venha dan√ßar e se divertir com os maiores sucessos do forr√≥ brasileiro!',
      'Wesley Safad√£o em Garanhuns! Uma noite inesquec√≠vel de forr√≥ no meio da semana.',
      'musical',
      categorias.forro,
      usuarioId,
      'published',
      true,
      false,
      '2025-01-29 20:00:00-03',
      '2025-01-30 02:00:00-03',
      'P√°tio de Eventos de Garanhuns',
      JSON.stringify({"street": "Av. Ruber van der Linden", "number": "s/n", "neighborhood": "Heli√≥polis", "city": "Garanhuns", "state": "PE", "zip_code": "55295-000"}),
      false,
      JSON.stringify({"phone": "+55 87 99999-1234", "email": "eventos@patiogaranhuns.com.br", "whatsapp": "+55 87 99999-1234"}),
      JSON.stringify({"name": "P√°tio de Eventos", "description": "O melhor espa√ßo para eventos de Garanhuns"}),
      'https://images.unsplash.com/photo-1493225457124-a3eb161ffa5f?w=800&h=400&fit=crop',
      ['forr√≥', 'wesley safad√£o', 'm√∫sica', 'dan√ßa', 'garanhuns']
    ]);
    console.log('‚úÖ Evento 1 criado: Forr√≥ Wesley Safad√£o');

    // Evento 2: Culto Especial - Quarta-feira
    await client.query(`
      INSERT INTO events (
        title, slug, description, short_description, event_type, category_id, created_by,
        status, is_featured, is_official, start_date, end_date, venue_name, address,
        is_free, contact_info, organizer_info, banner_image, tags
      ) VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19)
    `, [
      'Culto de Gratid√£o e B√™n√ß√£os',
      'culto-gratidao-bencaos',
      'Um culto especial de gratid√£o pelos primeiros dias do ano. Venha louvar e agradecer as b√™n√ß√£os recebidas em comunidade. Haver√° ora√ß√£o especial e ministra√ß√£o da palavra.',
      'Culto especial de gratid√£o. Venha dar gra√ßas pelas b√™n√ß√£os do ano que come√ßou.',
      'religious',
      categorias.religioso,
      usuarioId,
      'published',
      false,
      true,
      '2025-01-29 19:30:00-03',
      '2025-01-29 21:30:00-03',
      'Igreja Matriz de Santo Ant√¥nio',
      JSON.stringify({"street": "Pra√ßa Mestre Dominguinhos", "number": "s/n", "neighborhood": "Centro", "city": "Garanhuns", "state": "PE", "zip_code": "55295-000"}),
      true,
      JSON.stringify({"phone": "+55 87 3761-2345", "email": "matriz@garanhuns.org.br"}),
      JSON.stringify({"name": "Par√≥quia de Santo Ant√¥nio", "description": "Igreja Matriz de Garanhuns"}),
      'https://images.unsplash.com/photo-1507692049790-de58290a4334?w=800&h=400&fit=crop',
      ['religioso', 'culto', 'gratid√£o', 'b√™n√ß√£os', 'igreja', 'cat√≥lico']
    ]);
    console.log('‚úÖ Evento 2 criado: Culto de Gratid√£o');

    // Evento 3: Pe√ßa Teatral - Sexta-feira
    await client.query(`
      INSERT INTO events (
        title, slug, description, short_description, event_type, category_id, created_by,
        status, is_featured, is_official, start_date, end_date, venue_name, address,
        is_free, contact_info, organizer_info, banner_image, tags
      ) VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19)
    `, [
      'Auto da Compadecida - Grupo Teatral Sert√£o',
      'auto-compadecida-grupo-sertao',
      'O cl√°ssico de Ariano Suassuna ganha vida no palco com o renomado Grupo Teatral Sert√£o. Uma apresenta√ß√£o emocionante que retrata a cultura nordestina com humor e poesia.',
      'O Auto da Compadecida em uma apresenta√ß√£o √∫nica do Grupo Teatral Sert√£o.',
      'cultural',
      categorias.cultural,
      usuarioId,
      'published',
      true,
      true,
      '2025-01-31 20:00:00-03',
      '2025-01-31 22:00:00-03',
      'Teatro Guarany',
      JSON.stringify({"street": "Rua Vig√°rio Freire", "number": "134", "neighborhood": "Centro", "city": "Garanhuns", "state": "PE", "zip_code": "55295-000"}),
      false,
      JSON.stringify({"phone": "+55 87 3761-5678", "email": "teatroguarany@cultura.pe.gov.br"}),
      JSON.stringify({"name": "Secretaria de Cultura de Garanhuns", "description": "√ìrg√£o municipal respons√°vel pela cultura"}),
      'https://images.unsplash.com/photo-1507924538820-ede94a04019d?w=800&h=400&fit=crop',
      ['teatro', 'auto da compadecida', 'ariano suassuna', 'cultura nordestina', 'literatura']
    ]);
    console.log('‚úÖ Evento 3 criado: Auto da Compadecida');

    // Evento 4: Festival Gastron√¥mico - S√°bado
    await client.query(`
      INSERT INTO events (
        title, slug, description, short_description, event_type, category_id, created_by,
        status, is_featured, is_official, start_date, end_date, venue_name, address,
        is_free, contact_info, organizer_info, banner_image, tags
      ) VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19)
    `, [
      'Festival de Sabores do Agreste',
      'festival-sabores-agreste',
      'Um festival gastron√¥mico celebrando os sabores √∫nicos do agreste pernambucano. Pratos t√≠picos, food trucks, oficinas culin√°rias e muita divers√£o para toda a fam√≠lia.',
      'Festival gastron√¥mico com os melhores sabores do agreste. Comida boa e divers√£o garantida!',
      'gastronomic',
      categorias.gastronomico,
      usuarioId,
      'published',
      true,
      true,
      '2025-02-01 17:00:00-03',
      '2025-02-01 23:00:00-03',
      'Pra√ßa Tavares Correia',
      JSON.stringify({"street": "Pra√ßa Tavares Correia", "number": "s/n", "neighborhood": "Centro", "city": "Garanhuns", "state": "PE", "zip_code": "55295-000"}),
      true,
      JSON.stringify({"phone": "+55 87 3761-9999", "email": "turismo@garanhuns.pe.gov.br"}),
      JSON.stringify({"name": "Secretaria de Turismo", "description": "Promovendo o turismo gastron√¥mico em Garanhuns"}),
      'https://images.unsplash.com/photo-1414235077428-338989a2e8c0?w=800&h=400&fit=crop',
      ['gastronomia', 'festival', 'comida regional', 'food truck', 'agreste']
    ]);
    console.log('‚úÖ Evento 4 criado: Festival Gastron√¥mico');

    // Evento 5: Show Gospel - Domingo
    await client.query(`
      INSERT INTO events (
        title, slug, description, short_description, event_type, category_id, created_by,
        status, is_featured, is_official, start_date, end_date, venue_name, address,
        is_free, contact_info, organizer_info, banner_image, tags
      ) VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19)
    `, [
      'Domingo de Louvor com Aline Barros',
      'domingo-louvor-aline-barros',
      'Um domingo especial de louvor e adora√ß√£o com a cantora Aline Barros. Um momento de renova√ß√£o espiritual para toda a fam√≠lia crist√£ de Garanhuns e regi√£o.',
      'Aline Barros em Garanhuns! Domingo de louvor e adora√ß√£o para toda a fam√≠lia.',
      'religious',
      categorias.gospel,
      usuarioId,
      'published',
      true,
      false,
      '2025-02-02 16:00:00-03',
      '2025-02-02 19:00:00-03',
      'Arena Garanhuns',
      JSON.stringify({"street": "BR-423", "number": "Km 12", "neighborhood": "Mundo Novo", "city": "Garanhuns", "state": "PE", "zip_code": "55295-000"}),
      true,
      JSON.stringify({"phone": "+55 87 99988-7766", "email": "eventos@arenagaranhuns.com.br"}),
      JSON.stringify({"name": "Arena Garanhuns", "description": "Espa√ßo multiuso para grandes eventos"}),
      'https://images.unsplash.com/photo-1516450360452-9312f5e86fc7?w=800&h=400&fit=crop',
      ['gospel', 'aline barros', 'louvor', 'adora√ß√£o', 'fam√≠lia', 'm√∫sica crist√£']
    ]);
    console.log('‚úÖ Evento 5 criado: Show Gospel Aline Barros');

    // Evento 6: Roda de Samba - S√°bado
    await client.query(`
      INSERT INTO events (
        title, slug, description, short_description, event_type, category_id, created_by,
        status, is_featured, is_official, start_date, end_date, venue_name, address,
        is_free, contact_info, organizer_info, banner_image, tags
      ) VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19)
    `, [
      'Samba de Garanhuns - Roda de Samba',
      'samba-garanhuns-roda',
      'Uma aut√™ntica roda de samba no cora√ß√£o de Garanhuns. Venha curtir os cl√°ssicos do samba e descobrir novos talentos locais. Ambiente descontra√≠do e familiar.',
      'Roda de samba aut√™ntica em Garanhuns. Boa m√∫sica e ambiente familiar.',
      'musical',
      categorias.forro, // Usando categoria musical (forr√≥ tem parent musical)
      usuarioId,
      'published',
      false,
      false,
      '2025-02-01 21:00:00-03',
      '2025-02-02 01:00:00-03',
      'Bar do Z√© - Centro Cultural',
      JSON.stringify({"street": "Rua Quinze de Novembro", "number": "789", "neighborhood": "Centro", "city": "Garanhuns", "state": "PE", "zip_code": "55295-000"}),
      false,
      JSON.stringify({"phone": "+55 87 99876-5432", "email": "bardoze@garanhuns.com.br"}),
      JSON.stringify({"name": "Bar do Z√©", "description": "Tradicional casa de shows de Garanhuns"}),
      'https://images.unsplash.com/photo-1493225457124-a3eb161ffa5f?w=800&h=400&fit=crop',
      ['samba', 'roda de samba', 'm√∫sica brasileira', 'cultura', 'bar']
    ]);
    console.log('‚úÖ Evento 6 criado: Roda de Samba');

    // Verificar quantos eventos foram criados
    const totalEventos = await client.query('SELECT COUNT(*) as total FROM events');
    console.log(`\nüéä Total de eventos no banco: ${totalEventos.rows[0].total}`);

    // Mostrar eventos da semana criados
    const eventosSemana = await client.query(`
      SELECT title, start_date, venue_name 
      FROM events 
      WHERE start_date >= '2025-01-29' AND start_date <= '2025-02-02'
      ORDER BY start_date
    `);

    console.log('\nüìÖ Eventos da semana criados:');
    eventosSemana.rows.forEach(evento => {
      const data = new Date(evento.start_date).toLocaleDateString('pt-BR', {
        weekday: 'long',
        day: '2-digit',
        month: '2-digit',
        hour: '2-digit',
        minute: '2-digit'
      });
      console.log(`   üìç ${evento.title} - ${data} - ${evento.venue_name}`);
    });

    console.log('\nüéâ Eventos da semana criados com sucesso!');
    
  } catch (error) {
    console.error('‚ùå Erro ao criar eventos:', error.message);
    console.error(error);
  } finally {
    await client.end();
  }
}

// Executar
criarEventosSemana(); 